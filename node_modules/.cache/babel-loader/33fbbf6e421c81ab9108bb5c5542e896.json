{"ast":null,"code":"import _defineProperty from \"/Users/Andy/Desktop/Queued_demo/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/Users/Andy/Desktop/Queued_demo/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/Andy/Desktop/Queued_demo/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/Andy/Desktop/Queued_demo/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/Andy/Desktop/Queued_demo/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/Andy/Desktop/Queued_demo/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/Users/Andy/Desktop/Queued_demo/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/Users/Andy/Desktop/Queued_demo/src/components/Home/App.js\";\nimport React, { Component } from \"react\";\nimport * as $ from \"jquery\";\nimport { authEndpoint, clientId, redirectUri, scopes } from \"./config\";\nimport hash from \"./hash\";\nimport Player from \"./Player\";\nimport QueueList from \"./QueueList\";\nimport \"./App.css\";\nimport firebase from '../../firebase';\n\nvar App =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(App, _Component);\n\n  function App() {\n    var _this;\n\n    _classCallCheck(this, App);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(App).call(this));\n\n    _this.handleSearch = function (e) {\n      _this.setState(_defineProperty({}, e.target.name, e.target.value));\n    };\n\n    _this.handleSearchSubmit = function (e) {\n      e.preventDefault();\n\n      if (_this.state.songSearchText !== '') {\n        //search for the song\n        //set results to results\n        //update the list\n        $.ajax({\n          url: \"https://api.spotify.com/v1/search?q=\" + _this.state.songSearchText + \"&type=track&limit=10\",\n          type: \"GET\",\n          beforeSend: function beforeSend(xhr) {\n            xhr.setRequestHeader(\"Authorization\", \"Bearer \" + _this.state.token);\n          },\n          success: function success(data) {\n            if (data != undefined) {\n              var i;\n              var ul;\n              var i;\n              var li;\n\n              (function () {\n                console.log(data.tracks.items[0].id);\n                var ascResults = [];\n\n                for (i = 0; i < 10; i++) {\n                  ascResults.push({\n                    songTitle: data.tracks.items[i].name,\n                    songArtist: data.tracks.items[i].artists[0].name,\n                    songId: data.tracks.items[i].id\n                  });\n                }\n\n                _this.setState({\n                  songSearchResults: ascResults\n                });\n\n                console.log(_this.state.songSearchResults); //Now show a list of the results\n\n                var songs = _this.state.songSearchResults;\n                ul = document.getElementById(\"resultsList\"); //remove all children first\n\n                while (ul.firstChild) {\n                  ul.removeChild(ul.firstChild);\n                }\n\n                for (i = 0; i < 10; i++) {\n                  li = document.createElement(\"li\");\n                  li.setAttribute(\"id\", \"songResult\");\n                  li.setAttribute(\"name\", songs[i].songId);\n                  li.addEventListener(\"click\", function () {\n                    this.addSong(songs[i].songId);\n                  });\n                  li.appendChild(document.createTextNode(songs[i].songTitle + \" by \" + songs[i].songArtist));\n                  ul.appendChild(li);\n                } // this.setState({\n                //   item: data.item,\n                //   is_playing: data.is_playing,\n                //   progress_ms: data.progress_ms\n                // });\n\n              })();\n            } else {//it didn't work\n              }\n          }\n        }); //reset search field\n\n        _this.setState({\n          songSearchText: ''\n        });\n      }\n    };\n\n    _this.state = {\n      songSearchText: '',\n      songToSearch: '',\n      songSearchResults: [],\n      queue: [],\n      currentSong: null,\n      nextSong: null,\n      token: null,\n      item: {\n        album: {\n          images: [{\n            url: \"\"\n          }]\n        },\n        name: \"\",\n        artists: [{\n          name: \"\"\n        }],\n        duration_ms: 0\n      },\n      is_playing: \"Paused\",\n      progress_ms: 0\n    };\n    _this.getCurrentlyPlaying = _this.getCurrentlyPlaying.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"updateQueue\",\n    value: function updateQueue() {\n      var _this2 = this;\n\n      var queueRef = firebase.database().ref('queue');\n      queueRef.on('value', function (snapshot) {\n        var getQueue = snapshot.val();\n        var ascQueue = [];\n        var current = null;\n        var next = null;\n        var i = 0;\n\n        for (var song in getQueue) {\n          if (song !== undefined) {\n            //if this is the first song, it's currently playing\n            if (i == 0) {} //set current song to this title\n            //if this is the second song, it's next\n            else if (i == 1) {//set next song to this title\n              }\n\n            ascQueue.push({//add this song to ascQueue\n            });\n          }\n\n          i++;\n        }\n\n        var queue = getQueue.reverse();\n\n        _this2.setState({\n          queue: queue\n        });\n      });\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      // Set token\n      var _token = hash.access_token;\n      this.interval = window.setInterval(function () {\n        if (_token) {\n          // Set token\n          this.setState({\n            token: _token\n          }); //this.updateQueue(_token);\n\n          this.getCurrentlyPlaying(_token);\n        }\n      }.bind(this), 5000);\n    }\n  }, {\n    key: \"getCurrentlyPlaying\",\n    value: function getCurrentlyPlaying(token) {\n      var _this3 = this;\n\n      // Make a call using the token\n      $.ajax({\n        url: \"https://api.spotify.com/v1/me/player\",\n        type: \"GET\",\n        beforeSend: function beforeSend(xhr) {\n          xhr.setRequestHeader(\"Authorization\", \"Bearer \" + token);\n        },\n        success: function success(data) {\n          if (data != undefined) {\n            _this3.setState({\n              item: data.item,\n              is_playing: data.is_playing,\n              progress_ms: data.progress_ms\n            });\n          } else {\n            _this3.state = {\n              token: null,\n              item: {\n                album: {\n                  images: [{\n                    url: \"\"\n                  }]\n                },\n                name: \"\",\n                artists: [{\n                  name: \"\"\n                }],\n                duration_ms: 0\n              },\n              is_playing: \"Paused\",\n              progress_ms: 0\n            };\n          }\n        }\n      });\n    }\n  }, {\n    key: \"addSong\",\n    value: function addSong(songId) {\n      console.log(\"Add Song clicked. ID: \" + songId);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        className: \"App\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 188\n        },\n        __self: this\n      }, React.createElement(\"header\", {\n        className: \"App-header\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 189\n        },\n        __self: this\n      }, !this.state.token && React.createElement(\"a\", {\n        className: \"btn btn--loginApp-link\",\n        href: \"\".concat(authEndpoint, \"?client_id=\").concat(clientId, \"&redirect_uri=\").concat(redirectUri, \"&scope=\").concat(scopes.join(\"%20\"), \"&response_type=token&show_dialog=true\"),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191\n        },\n        __self: this\n      }, \"Login to Spotify\"), this.state.token && React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 201\n        },\n        __self: this\n      }, React.createElement(Player, {\n        item: this.state.item,\n        is_playing: this.state.is_playing,\n        progress_ms: this.progress_ms,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 202\n        },\n        __self: this\n      }), React.createElement(QueueList, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 207\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"searchsong\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 208\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"main-wrapper\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 209\n        },\n        __self: this\n      }, React.createElement(\"form\", {\n        className: \"send-song\",\n        onSubmit: this.handleSearchSubmit,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 210\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        type: \"text\",\n        name: \"songSearchText\",\n        id: \"searchText\",\n        value: this.state.songSearchText,\n        onChange: this.handleSearch,\n        placeholder: \"Search for a song\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 211\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"container\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 213\n        },\n        __self: this\n      }, React.createElement(\"ul\", {\n        className: \"result-list\",\n        id: \"resultsList\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 214\n        },\n        __self: this\n      })))))));\n    }\n  }]);\n\n  return App;\n}(Component);\n\nexport default App;","map":{"version":3,"sources":["/Users/Andy/Desktop/Queued_demo/src/components/Home/App.js"],"names":["React","Component","$","authEndpoint","clientId","redirectUri","scopes","hash","Player","QueueList","firebase","App","handleSearch","e","setState","target","name","value","handleSearchSubmit","preventDefault","state","songSearchText","ajax","url","type","beforeSend","xhr","setRequestHeader","token","success","data","undefined","i","ul","li","console","log","tracks","items","id","ascResults","push","songTitle","songArtist","artists","songId","songSearchResults","songs","document","getElementById","firstChild","removeChild","createElement","setAttribute","addEventListener","addSong","appendChild","createTextNode","songToSearch","queue","currentSong","nextSong","item","album","images","duration_ms","is_playing","progress_ms","getCurrentlyPlaying","bind","queueRef","database","ref","on","snapshot","getQueue","val","ascQueue","current","next","song","reverse","_token","access_token","interval","window","setInterval","join"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport * as $ from \"jquery\";\nimport { authEndpoint, clientId, redirectUri, scopes } from \"./config\";\nimport hash from \"./hash\";\nimport Player from \"./Player\";\nimport QueueList from \"./QueueList\";\nimport \"./App.css\";\nimport firebase from '../../firebase';\n\nclass App extends Component {\n  constructor() {\n    super();\n    this.state = {\n      songSearchText: '',\n      songToSearch: '',\n      songSearchResults: [],\n      queue: [],\n      currentSong: null,\n      nextSong: null,\n      token: null,\n      item: {\n        album: {\n          images: [{ url: \"\" }]\n        },\n        name: \"\",\n        artists: [{ name: \"\" }],\n        duration_ms: 0\n      },\n      is_playing: \"Paused\",\n      progress_ms: 0\n    };\n    this.getCurrentlyPlaying = this.getCurrentlyPlaying.bind(this);\n  }\n\n  updateQueue(){\n    const queueRef = firebase.database().ref('queue');\n\n    queueRef.on('value', snapshot => {\n      const getQueue = snapshot.val();\n      let ascQueue = [];\n      let current = null;\n      let next = null;\n      var i = 0;\n      for(let song in getQueue){\n        if(song !== undefined){\n          //if this is the first song, it's currently playing\n          if (i == 0){\n            //set current song to this title\n          }\n          //if this is the second song, it's next\n          else if (i == 1){\n            //set next song to this title\n          }\n          ascQueue.push({\n            //add this song to ascQueue\n          });\n        }\n        i++;\n      }\n      const queue = getQueue.reverse();\n      this.setState({queue: queue});\n    });\n  }\n\n  componentDidMount() {\n    // Set token\n    let _token = hash.access_token;\n\n    this.interval = window.setInterval(\n      (function () {\n        if (_token) {\n          // Set token\n          this.setState({\n            token: _token\n          });\n          //this.updateQueue(_token);\n          this.getCurrentlyPlaying(_token);\n        }\n      }).bind(this),\n      5000\n    )\n  }\n\n  getCurrentlyPlaying(token) {\n    // Make a call using the token\n    $.ajax({\n      url: \"https://api.spotify.com/v1/me/player\",\n      type: \"GET\",\n      beforeSend: xhr => {\n        xhr.setRequestHeader(\"Authorization\", \"Bearer \" + token);\n      },\n      success: data => {\n        if (data != undefined){\n          this.setState({\n            item: data.item,\n            is_playing: data.is_playing,\n            progress_ms: data.progress_ms\n          });\n        }\n        else {\n          this.state = {\n            token: null,\n            item: {\n              album: {\n                images: [{ url: \"\" }]\n              },\n              name: \"\",\n              artists: [{ name: \"\" }],\n              duration_ms: 0\n            },\n            is_playing: \"Paused\",\n            progress_ms: 0\n          };\n        }\n      }\n    });\n  }\n\n  addSong(songId){\n    console.log(\"Add Song clicked. ID: \" + songId);\n  }\n\n  handleSearch = e => {\n    this.setState({[e.target.name]: e.target.value});\n  }\n\n  handleSearchSubmit = e => {\n    e.preventDefault();\n    if(this.state.songSearchText !== ''){\n      //search for the song\n      //set results to results\n      //update the list\n      $.ajax({\n        url: \"https://api.spotify.com/v1/search?q=\" + this.state.songSearchText + \"&type=track&limit=10\",\n        type: \"GET\",\n        beforeSend: xhr => {\n          xhr.setRequestHeader(\"Authorization\", \"Bearer \" + this.state.token);\n        },\n        success: data => {\n          if (data != undefined){\n            console.log(data.tracks.items[0].id);\n            let ascResults = [];\n            for (var i = 0; i < 10; i++){\n              ascResults.push({\n                songTitle: data.tracks.items[i].name,\n                songArtist: data.tracks.items[i].artists[0].name,\n                songId: data.tracks.items[i].id\n              })\n            }\n            this.setState({songSearchResults: ascResults});\n            console.log(this.state.songSearchResults);\n\n            //Now show a list of the results\n            let songs = this.state.songSearchResults;\n            var ul = document.getElementById(\"resultsList\");\n            //remove all children first\n            while(ul.firstChild) ul.removeChild(ul.firstChild);\n            for (var i = 0; i < 10; i++){\n              var li = document.createElement(\"li\");\n              li.setAttribute(\"id\", \"songResult\");\n              li.setAttribute(\"name\", songs[i].songId);\n              li.addEventListener(\"click\", function(){\n                this.addSong(songs[i].songId);\n              });\n              li.appendChild(document.createTextNode(songs[i].songTitle + \" by \" + songs[i].songArtist));\n              ul.appendChild(li);\n            }\n\n            // this.setState({\n            //   item: data.item,\n            //   is_playing: data.is_playing,\n            //   progress_ms: data.progress_ms\n            // });\n          }\n          else {\n            //it didn't work\n          }\n        }\n      });\n\n      //reset search field\n      this.setState({songSearchText: ''});\n    }\n  }\n\n  render() {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          {!this.state.token && (\n            <a\n              className=\"btn btn--loginApp-link\"\n              href={`${authEndpoint}?client_id=${clientId}&redirect_uri=${redirectUri}&scope=${scopes.join(\n                \"%20\"\n              )}&response_type=token&show_dialog=true`}\n            >\n              Login to Spotify\n            </a>\n          )}\n          {this.state.token && (\n            <div>\n              <Player\n                item={this.state.item}\n                is_playing={this.state.is_playing}\n                progress_ms={this.progress_ms}\n              />\n              <QueueList />\n              <div className=\"searchsong\">\n                <div className=\"main-wrapper\">\n                  <form className=\"send-song\" onSubmit={this.handleSearchSubmit}>\n                    <input type=\"text\" name=\"songSearchText\" id=\"searchText\" value={this.state.songSearchText} onChange={this.handleSearch} placeholder='Search for a song' />\n                  </form>\n                  <div className=\"container\">\n                    <ul className='result-list' id='resultsList'>\n                    </ul>\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n        </header>\n      </div>\n    );\n  }\n}\n\nexport default App;"]},"metadata":{},"sourceType":"module"}