{"ast":null,"code":"import _defineProperty from \"/Users/Andy/Desktop/Queued_demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/Users/Andy/Desktop/Queued_demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/Andy/Desktop/Queued_demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/Andy/Desktop/Queued_demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/Andy/Desktop/Queued_demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/Andy/Desktop/Queued_demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/Users/Andy/Desktop/Queued_demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/Users/Andy/Desktop/Queued_demo/src/components/Home/App.js\";\nimport React, { Component } from \"react\";\nimport * as $ from \"jquery\";\nimport { authEndpoint, clientId, redirectUri, scopes } from \"./config\";\nimport hash from \"./hash\";\nimport Player from \"./Player\";\nimport QueueList from \"./QueueList\";\nimport \"./App.css\";\nimport firebase from '../../firebase';\n\nvar App =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(App, _Component);\n\n  function App() {\n    var _this;\n\n    _classCallCheck(this, App);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(App).call(this));\n\n    _this.addSong = function (e) {\n      e.preventDefault();\n      console.log(\"Add Song clicked. ID: \" + e.target.title); //add the song to the queue\n\n      var queueRef = firebase.database().ref('queue');\n      var newSong = {\n        songTitleAndArtist: e.target.innerText,\n        songId: e.target.title\n      };\n      queueRef.push(newSong); //Remove children from the search list\n\n      var ul = document.getElementById(\"resultsList\"); //remove all children first\n\n      while (ul.firstChild) {\n        ul.removeChild(ul.firstChild);\n      } //TODO: update the queue to show the changes\n\n    };\n\n    _this.handleSearch = function (e) {\n      _this.setState(_defineProperty({}, e.target.name, e.target.value));\n    };\n\n    _this.handleSearchSubmit = function (e) {\n      e.preventDefault();\n\n      if (_this.state.songSearchText !== '') {\n        //search for the song\n        //set results to results\n        //update the list\n        $.ajax({\n          url: \"https://api.spotify.com/v1/search?q=\" + _this.state.songSearchText + \"&type=track&limit=10\",\n          type: \"GET\",\n          beforeSend: function beforeSend(xhr) {\n            xhr.setRequestHeader(\"Authorization\", \"Bearer \" + _this.state.token);\n          },\n          success: function success(data) {\n            if (data != undefined) {\n              console.log(data.tracks.items[0].id);\n              var ascResults = [];\n\n              for (var i = 0; i < 10; i++) {\n                ascResults.push({\n                  songTitle: data.tracks.items[i].name,\n                  songArtist: data.tracks.items[i].artists[0].name,\n                  songId: data.tracks.items[i].id\n                });\n              }\n\n              _this.setState({\n                songSearchResults: ascResults\n              });\n\n              console.log(_this.state.songSearchResults); //Now show a list of the results\n\n              var songs = _this.state.songSearchResults;\n              var ul = document.getElementById(\"resultsList\"); //remove all children first\n\n              while (ul.firstChild) {\n                ul.removeChild(ul.firstChild);\n              }\n\n              for (var i = 0; i < 10; i++) {\n                var li = document.createElement(\"li\");\n                li.setAttribute(\"id\", \"songResult\");\n                li.setAttribute(\"title\", songs[i].songId);\n                li.addEventListener(\"click\", _this.addSong);\n                li.appendChild(document.createTextNode(songs[i].songTitle + \" by \" + songs[i].songArtist));\n                ul.appendChild(li);\n              } // this.setState({\n              //   item: data.item,\n              //   is_playing: data.is_playing,\n              //   progress_ms: data.progress_ms\n              // });\n\n            } else {//it didn't work\n              }\n          }\n        }); //reset search field\n\n        _this.setState({\n          songSearchText: ''\n        });\n      }\n    };\n\n    _this.handleCreatePlaylistClick = function (e) {\n      e.preventDefault();\n      console.log(\"Create Playlist Click\"); //check if this playlist exists\n\n      $.ajax({\n        url: \"https://api.spotify.com/v1/users/\" + _this.state.userId + \"/playlists?limit=50\",\n        type: \"GET\",\n        beforeSend: function beforeSend(xhr) {\n          xhr.setRequestHeader(\"Accept\", \"application/json\");\n          xhr.setRequestHeader(\"Content-Type\", \"application/json\");\n          xhr.setRequestHeader(\"Authorization\", \"Bearer \" + _this.state.token);\n        },\n        success: function success(data) {\n          console.log(data);\n\n          if (data != undefined) {\n            console.log(data.total);\n            var exists = false;\n\n            for (var item in data.items) {\n              if (data.items[item].owner.id === _this.state.userId && data.items[item].name === 'Queued Party Playlist' && exists === false) {\n                console.log(\"Replacing playlist songs\");\n\n                _this.replacePlaylistSongs(_this.state.token, data.items[item].id);\n\n                exists = true;\n              }\n            }\n\n            if (exists === false) {\n              console.log(\"playlist does not exist, creating a new one\");\n\n              _this.createPlaylist(_this.state.userId, _this.state.token);\n            }\n          }\n        }\n      });\n    };\n\n    _this.state = {\n      userId: '',\n      songSearchText: '',\n      songIdToAdd: '',\n      songSearchResults: [],\n      queue: [],\n      currentSongDBUID: null,\n      nextSongDBUID: null,\n      token: null,\n      device: '',\n      item: {\n        album: {\n          images: [{\n            url: \"\"\n          }]\n        },\n        name: \"\",\n        artists: [{\n          name: \"\"\n        }],\n        duration_ms: 0\n      },\n      is_playing: \"Paused\",\n      progress_ms: 0\n    };\n    _this.getCurrentlyPlaying = _this.getCurrentlyPlaying.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      // Set token\n      var _token = hash.access_token;\n\n      if (_token) {\n        // Set token\n        this.setState({\n          token: _token\n        });\n        this.getUserID(_token); //load the queue\n\n        this.getQueue(_token); //get device\n\n        this.getCurrentDevice(_token); //this.updateQueue(_token);\n\n        this.getCurrentlyPlaying(_token);\n      }\n\n      this.interval = window.setInterval(function () {\n        if (_token) {\n          // Set token\n          this.setState({\n            token: _token\n          }); //this.updateQueue(_token);\n          //set song to first in the queue\n\n          this.getCurrentlyPlaying(_token);\n        }\n\n        console.log(this.state.item.duration_ms);\n      }.bind(this), 5000);\n    }\n  }, {\n    key: \"getCurrentlyPlaying\",\n    value: function getCurrentlyPlaying(token) {\n      var _this2 = this;\n\n      // Make a call using the token\n      $.ajax({\n        url: \"https://api.spotify.com/v1/me/player\",\n        type: \"GET\",\n        beforeSend: function beforeSend(xhr) {\n          xhr.setRequestHeader(\"Authorization\", \"Bearer \" + token);\n        },\n        success: function success(data) {\n          if (data != undefined) {\n            _this2.setState({\n              item: data.item,\n              is_playing: data.is_playing,\n              progress_ms: data.progress_ms\n            });\n          } else {\n            _this2.state = {\n              token: null,\n              item: {\n                album: {\n                  images: [{\n                    url: \"\"\n                  }]\n                },\n                name: \"\",\n                artists: [{\n                  name: \"\"\n                }],\n                duration_ms: 0\n              },\n              is_playing: \"Paused\",\n              progress_ms: 0\n            };\n          }\n        }\n      });\n    }\n  }, {\n    key: \"getCurrentDevice\",\n    value: function getCurrentDevice(token) {\n      var _this3 = this;\n\n      $.ajax({\n        url: \"https://api.spotify.com/v1/me/player/devices\",\n        type: \"GET\",\n        beforeSend: function beforeSend(xhr) {\n          xhr.setRequestHeader(\"Authorization\", \"Bearer \" + token);\n        },\n        success: function success(data) {\n          if (data != undefined) {\n            console.log(data);\n\n            if (data.devices.length > 0) {\n              console.log(data.devices[0].id);\n\n              _this3.setState({\n                device: data.devices[0].id\n              });\n            }\n          }\n        }\n      });\n    }\n  }, {\n    key: \"getUserID\",\n    value: function getUserID(token) {\n      var _this4 = this;\n\n      $.ajax({\n        url: \"https://api.spotify.com/v1/me\",\n        type: \"GET\",\n        beforeSend: function beforeSend(xhr) {\n          xhr.setRequestHeader(\"Authorization\", \"Bearer \" + token);\n        },\n        success: function success(data) {\n          if (data != undefined) {\n            _this4.setState({\n              userId: data.id\n            });\n          }\n        }\n      });\n    }\n  }, {\n    key: \"getQueue\",\n    value: function getQueue(token) {\n      var _this5 = this;\n\n      var queueRef = firebase.database().ref('queue');\n      queueRef.on('value', function (snapshot) {\n        var getQueue = snapshot.val();\n        console.log(getQueue);\n        var ascQueue = [];\n\n        for (var song in getQueue) {\n          console.log(getQueue[song].songTitleAndArtist);\n\n          if (getQueue[song] !== undefined) {\n            ascQueue.push({\n              //add this song to ascQueue\n              songId: getQueue[song].songId,\n              songTitleAndArtist: getQueue[song].songTitleAndArtist\n            });\n          }\n        }\n\n        _this5.setState({\n          queue: ascQueue\n        });\n\n        console.log(\"Queue: \" + _this5.state.queue[0].songTitleAndArtist);\n      });\n    }\n  }, {\n    key: \"setFirstSong\",\n    value: function setFirstSong(token) {\n      $.ajax({\n        url: \"https://api.spotify.com/v1/me/player/play?device_id=\" + this.state.device + \"\",\n        type: \"PUT\",\n        data: \"{\\\"uris\\\":[\\\"spotify:track:\" + this.state.queue[0].songId + \"\\\"],\\\"position_ms\\\":0}\",\n        beforeSend: function beforeSend(xhr) {\n          xhr.setRequestHeader(\"Authorization\", \"Bearer \" + token);\n        },\n        success: function success(data) {\n          if (data != undefined) {\n            console.log(\"success: \" + data);\n          } else {}\n        }\n      });\n    }\n  }, {\n    key: \"updateQueue\",\n    value: function updateQueue(token) {\n      var _this6 = this;\n\n      //console.log(\"token: \" + token);\n      var queueRef = firebase.database().ref('queue');\n      queueRef.on('value', function (snapshot) {\n        var getQueue = snapshot.val();\n        var ascQueue = [];\n\n        for (var song in getQueue) {\n          if (getQueue[song] !== undefined) {\n            ascQueue.push({\n              //add this song to ascQueue\n              songId: getQueue[song].songId,\n              songTitleAndArtist: getQueue[song].songTitleAndArtist\n            });\n          }\n        }\n\n        _this6.setState({\n          queue: ascQueue\n        });\n      });\n    }\n  }, {\n    key: \"createPlaylist\",\n    value: function createPlaylist(userId, token) {\n      var _this7 = this;\n\n      //create a playlist\n      $.ajax({\n        url: \"https://api.spotify.com/v1/users/\" + userId + \"/playlists\",\n        type: \"POST\",\n        data: \"{\\\"name\\\":\\\"Queued Party Playlist\\\",\\\"description\\\":\\\"Queued Party\\\",\\\"public\\\":true}\",\n        beforeSend: function beforeSend(xhr) {\n          xhr.setRequestHeader(\"Content-Type\", \"application/json\");\n          xhr.setRequestHeader(\"Authorization\", \"Bearer \" + token);\n        },\n        success: function success(data) {\n          if (data != undefined) {\n            _this7.addPlaylistSongs(token, data.id);\n          }\n        }\n      });\n    }\n  }, {\n    key: \"addPlaylistSongs\",\n    value: function addPlaylistSongs(token, playlistId) {\n      var _this8 = this;\n\n      this.updateQueue(token); //create list for adding tracks\n\n      var tracks = '';\n      this.state.queue.map(function (song) {\n        return tracks = tracks + \"spotify%3Atrack%3A\" + song.songId + \",\";\n      });\n      $.ajax({\n        url: \"https://api.spotify.com/v1/playlists/\" + playlistId + \"/tracks?uris=\" + tracks,\n        type: \"POST\",\n        beforeSend: function beforeSend(xhr) {\n          xhr.setRequestHeader(\"Accept\", \"application/json\");\n          xhr.setRequestHeader(\"Content-Type\", \"application/json\");\n          xhr.setRequestHeader(\"Authorization\", \"Bearer \" + _this8.state.token);\n        },\n        success: function success(data) {\n          if (data != undefined) {\n            console.log(data);\n          }\n        }\n      });\n    }\n  }, {\n    key: \"replacePlaylistSongs\",\n    value: function replacePlaylistSongs(token, playlistId) {\n      var _this9 = this;\n\n      this.updateQueue(token); //create list for adding tracks\n\n      var tracks = '';\n      this.state.queue.map(function (song) {\n        return tracks = tracks + \"spotify%3Atrack%3A\" + song.songId + \",\";\n      });\n      $.ajax({\n        url: \"https://api.spotify.com/v1/playlists/\" + playlistId + \"/tracks?uris=\" + tracks,\n        type: \"PUT\",\n        beforeSend: function beforeSend(xhr) {\n          xhr.setRequestHeader(\"Accept\", \"application/json\");\n          xhr.setRequestHeader(\"Content-Type\", \"application/json\");\n          xhr.setRequestHeader(\"Authorization\", \"Bearer \" + _this9.state.token);\n        },\n        success: function success(data) {\n          if (data != undefined) {\n            console.log(data);\n          }\n        }\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        className: \"App\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 390\n        },\n        __self: this\n      }, React.createElement(\"header\", {\n        className: \"App-header\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 391\n        },\n        __self: this\n      }, !this.state.token && React.createElement(\"a\", {\n        className: \"btn btn--loginApp-link\",\n        href: \"\".concat(authEndpoint, \"?client_id=\").concat(clientId, \"&redirect_uri=\").concat(redirectUri, \"&scope=\").concat(scopes.join(\"%20\"), \"&response_type=token&show_dialog=true\"),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 393\n        },\n        __self: this\n      }, \"Login to Spotify\"), this.state.token && React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 403\n        },\n        __self: this\n      }, React.createElement(Player, {\n        item: this.state.item,\n        is_playing: this.state.is_playing,\n        progress_ms: this.progress_ms,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 404\n        },\n        __self: this\n      }), \"\\n\", React.createElement(\"div\", {\n        className: \"addPlaylist\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 410\n        },\n        __self: this\n      }, React.createElement(\"button\", {\n        className: \"btn btn--loginApp-link\",\n        onClick: this.handleCreatePlaylistClick,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 411\n        },\n        __self: this\n      }, \"Create Playlist\")), \"\\n\", React.createElement(QueueList, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 416\n        },\n        __self: this\n      }), \"\\n\", React.createElement(\"div\", {\n        className: \"searchsong\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 418\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"main-wrapper\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 419\n        },\n        __self: this\n      }, React.createElement(\"h1\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 420\n        },\n        __self: this\n      }, \"Add a song:\"), \"\\n\", React.createElement(\"form\", {\n        className: \"send-song\",\n        onSubmit: this.handleSearchSubmit,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 422\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        type: \"text\",\n        name: \"songSearchText\",\n        id: \"searchText\",\n        value: this.state.songSearchText,\n        onChange: this.handleSearch,\n        placeholder: \"Search for a song\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 423\n        },\n        __self: this\n      })), \"\\n\", React.createElement(\"div\", {\n        className: \"container\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 426\n        },\n        __self: this\n      }, React.createElement(\"ul\", {\n        className: \"result-list\",\n        id: \"resultsList\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 427\n        },\n        __self: this\n      })))))));\n    }\n  }]);\n\n  return App;\n}(Component);\n\nexport default App;","map":{"version":3,"sources":["/Users/Andy/Desktop/Queued_demo/src/components/Home/App.js"],"names":["React","Component","$","authEndpoint","clientId","redirectUri","scopes","hash","Player","QueueList","firebase","App","addSong","e","preventDefault","console","log","target","title","queueRef","database","ref","newSong","songTitleAndArtist","innerText","songId","push","ul","document","getElementById","firstChild","removeChild","handleSearch","setState","name","value","handleSearchSubmit","state","songSearchText","ajax","url","type","beforeSend","xhr","setRequestHeader","token","success","data","undefined","tracks","items","id","ascResults","i","songTitle","songArtist","artists","songSearchResults","songs","li","createElement","setAttribute","addEventListener","appendChild","createTextNode","handleCreatePlaylistClick","userId","total","exists","item","owner","replacePlaylistSongs","createPlaylist","songIdToAdd","queue","currentSongDBUID","nextSongDBUID","device","album","images","duration_ms","is_playing","progress_ms","getCurrentlyPlaying","bind","_token","access_token","getUserID","getQueue","getCurrentDevice","interval","window","setInterval","devices","length","on","snapshot","val","ascQueue","song","addPlaylistSongs","playlistId","updateQueue","map","join"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport * as $ from \"jquery\";\nimport { authEndpoint, clientId, redirectUri, scopes } from \"./config\";\nimport hash from \"./hash\";\nimport Player from \"./Player\";\nimport QueueList from \"./QueueList\";\nimport \"./App.css\";\nimport firebase from '../../firebase';\n\nclass App extends Component {\n  constructor() {\n    super();\n    this.state = {\n      userId: '',\n      songSearchText: '',\n      songIdToAdd: '',\n      songSearchResults: [],\n      queue: [],\n      currentSongDBUID: null,\n      nextSongDBUID: null,\n      token: null,\n      device: '',\n      item: {\n        album: {\n          images: [{ url: \"\" }]\n        },\n        name: \"\",\n        artists: [{ name: \"\" }],\n        duration_ms: 0\n      },\n      is_playing: \"Paused\",\n      progress_ms: 0\n    };\n    this.getCurrentlyPlaying = this.getCurrentlyPlaying.bind(this);\n  }\n\n  componentDidMount() {\n    // Set token\n    let _token = hash.access_token;\n\n    if (_token) {\n      // Set token\n      this.setState({\n        token: _token\n      });\n      this.getUserID(_token);\n      //load the queue\n      this.getQueue(_token);\n      //get device\n      this.getCurrentDevice(_token);\n      //this.updateQueue(_token);\n      this.getCurrentlyPlaying(_token);\n    }\n\n    this.interval = window.setInterval(\n      (function () {\n        if (_token) {\n          // Set token\n          this.setState({\n            token: _token\n          });\n          //this.updateQueue(_token);\n          //set song to first in the queue\n          this.getCurrentlyPlaying(_token);\n        }\n        console.log(this.state.item.duration_ms);\n      }).bind(this),\n      5000\n    )\n  }\n\n  getCurrentlyPlaying(token) {\n    // Make a call using the token\n    $.ajax({\n      url: \"https://api.spotify.com/v1/me/player\",\n      type: \"GET\",\n      beforeSend: xhr => {\n        xhr.setRequestHeader(\"Authorization\", \"Bearer \" + token);\n      },\n      success: data => {\n        if (data != undefined){\n          this.setState({\n            item: data.item,\n            is_playing: data.is_playing,\n            progress_ms: data.progress_ms\n          });\n        }\n        else {\n          this.state = {\n            token: null,\n            item: {\n              album: {\n                images: [{ url: \"\" }]\n              },\n              name: \"\",\n              artists: [{ name: \"\" }],\n              duration_ms: 0\n            },\n            is_playing: \"Paused\",\n            progress_ms: 0\n          };\n        }\n      }\n    });\n  }\n\n  getCurrentDevice(token){\n    $.ajax({\n      url: \"https://api.spotify.com/v1/me/player/devices\",\n      type: \"GET\",\n      beforeSend: xhr => {\n        xhr.setRequestHeader(\"Authorization\", \"Bearer \" + token);\n      },\n      success: data => {\n        if (data != undefined){\n          console.log(data);\n          if(data.devices.length > 0){\n            console.log(data.devices[0].id);\n            this.setState({\n              device: data.devices[0].id\n            });\n          }\n        }\n      }\n    });\n  }\n\n  getUserID(token){\n    $.ajax({\n      url: \"https://api.spotify.com/v1/me\",\n      type: \"GET\",\n      beforeSend: xhr => {\n        xhr.setRequestHeader(\"Authorization\", \"Bearer \" + token);\n      },\n      success: data => {\n        if (data != undefined){\n          this.setState({\n            userId: data.id\n          });\n        }\n      }\n    });\n  }\n\n  getQueue(token){\n    const queueRef = firebase.database().ref('queue');\n\n    queueRef.on('value', snapshot => {\n      const getQueue = snapshot.val();\n      console.log(getQueue);\n      let ascQueue = [];\n      for(let song in getQueue){\n        console.log(getQueue[song].songTitleAndArtist);\n        if(getQueue[song] !== undefined){\n          ascQueue.push({\n            //add this song to ascQueue\n            songId: getQueue[song].songId,\n            songTitleAndArtist: getQueue[song].songTitleAndArtist\n          });\n        }\n      }\n      this.setState({queue: ascQueue});\n      console.log(\"Queue: \" + this.state.queue[0].songTitleAndArtist)\n    });\n  }\n\n  setFirstSong(token){\n    $.ajax({\n      url: \"https://api.spotify.com/v1/me/player/play?device_id=\" + this.state.device + \"\",\n      type: \"PUT\",\n      data: \"{\\\"uris\\\":[\\\"spotify:track:\" + this.state.queue[0].songId + \"\\\"],\\\"position_ms\\\":0}\",\n      beforeSend: xhr => {\n        xhr.setRequestHeader(\"Authorization\", \"Bearer \" + token);\n      },\n      success: data => {\n        if (data != undefined){\n          console.log(\"success: \" + data);\n        }\n        else {\n          \n        }\n      }\n    });\n  }\n\n  updateQueue(token){\n    //console.log(\"token: \" + token);\n    const queueRef = firebase.database().ref('queue');\n\n    queueRef.on('value', snapshot => {\n      const getQueue = snapshot.val();\n      let ascQueue = [];\n      for(let song in getQueue){\n        if(getQueue[song] !== undefined){\n          ascQueue.push({\n            //add this song to ascQueue\n            songId: getQueue[song].songId,\n            songTitleAndArtist: getQueue[song].songTitleAndArtist\n          });\n        }\n      }\n      this.setState({queue: ascQueue});\n    });\n  }\n\n  addSong = e =>{\n    e.preventDefault();\n    console.log(\"Add Song clicked. ID: \" + e.target.title);\n    //add the song to the queue\n    const queueRef = firebase.database().ref('queue');\n    const newSong = {\n      songTitleAndArtist: e.target.innerText,\n      songId: e.target.title\n    }\n    queueRef.push(newSong);\n    //Remove children from the search list\n    var ul = document.getElementById(\"resultsList\");\n    //remove all children first\n    while(ul.firstChild) ul.removeChild(ul.firstChild);\n    //TODO: update the queue to show the changes\n  }\n\n  handleSearch = e => {\n    this.setState({[e.target.name]: e.target.value});\n  }\n\n  handleSearchSubmit = e => {\n    e.preventDefault();\n    if(this.state.songSearchText !== ''){\n      //search for the song\n      //set results to results\n      //update the list\n      $.ajax({\n        url: \"https://api.spotify.com/v1/search?q=\" + this.state.songSearchText + \"&type=track&limit=10\",\n        type: \"GET\",\n        beforeSend: xhr => {\n          xhr.setRequestHeader(\"Authorization\", \"Bearer \" + this.state.token);\n        },\n        success: data => {\n          if (data != undefined){\n            console.log(data.tracks.items[0].id);\n            let ascResults = [];\n            for (var i = 0; i < 10; i++){\n              ascResults.push({\n                songTitle: data.tracks.items[i].name,\n                songArtist: data.tracks.items[i].artists[0].name,\n                songId: data.tracks.items[i].id\n              })\n            }\n            this.setState({songSearchResults: ascResults});\n            console.log(this.state.songSearchResults);\n\n            //Now show a list of the results\n            let songs = this.state.songSearchResults;\n            var ul = document.getElementById(\"resultsList\");\n            //remove all children first\n            while(ul.firstChild) ul.removeChild(ul.firstChild);\n            for (var i = 0; i < 10; i++){\n              var li = document.createElement(\"li\");\n              li.setAttribute(\"id\", \"songResult\");\n              li.setAttribute(\"title\", songs[i].songId);\n              li.addEventListener(\"click\", this.addSong);\n              li.appendChild(document.createTextNode(songs[i].songTitle + \" by \" + songs[i].songArtist));\n              ul.appendChild(li);\n            }\n\n            // this.setState({\n            //   item: data.item,\n            //   is_playing: data.is_playing,\n            //   progress_ms: data.progress_ms\n            // });\n          }\n          else {\n            //it didn't work\n          }\n        }\n      });\n\n      //reset search field\n      this.setState({songSearchText: ''});\n    }\n  }\n\n  handleCreatePlaylistClick = e => {\n    e.preventDefault();\n    console.log(\"Create Playlist Click\");\n\n    //check if this playlist exists\n    $.ajax({\n      url: \"https://api.spotify.com/v1/users/\" + this.state.userId + \"/playlists?limit=50\",\n      type: \"GET\",\n      beforeSend: xhr => {\n        xhr.setRequestHeader(\"Accept\", \"application/json\");\n        xhr.setRequestHeader(\"Content-Type\", \"application/json\");\n        xhr.setRequestHeader(\"Authorization\", \"Bearer \" + this.state.token);\n      },\n      success: data => {\n        console.log(data);\n        if (data != undefined){\n          console.log(data.total);\n          var exists = false;\n          for (let item in data.items){\n            if (data.items[item].owner.id === this.state.userId && data.items[item].name === 'Queued Party Playlist' && exists === false){\n              console.log(\"Replacing playlist songs\");\n              this.replacePlaylistSongs(this.state.token, data.items[item].id);\n              exists = true;\n            }\n          }\n          if (exists === false){\n            console.log(\"playlist does not exist, creating a new one\");\n            this.createPlaylist(this.state.userId, this.state.token);\n          }\n        }\n      }\n    });\n  }\n\n  createPlaylist(userId, token){\n    //create a playlist\n    $.ajax({\n      url: \"https://api.spotify.com/v1/users/\" + userId + \"/playlists\",\n      type: \"POST\",\n      data: \"{\\\"name\\\":\\\"Queued Party Playlist\\\",\\\"description\\\":\\\"Queued Party\\\",\\\"public\\\":true}\",\n      beforeSend: xhr => {\n        xhr.setRequestHeader(\"Content-Type\", \"application/json\");\n        xhr.setRequestHeader(\"Authorization\", \"Bearer \" + token);\n      },\n      success: data => {\n        if (data != undefined){\n          this.addPlaylistSongs(token, data.id);\n        }\n      }\n    });\n  }\n\n  addPlaylistSongs(token, playlistId){\n    this.updateQueue(token);\n\n    //create list for adding tracks\n    var tracks = '';\n\n    this.state.queue.map((song) => \n      tracks = tracks + \"spotify%3Atrack%3A\" + song.songId + \",\"\n    )\n\n    $.ajax({\n      url: \"https://api.spotify.com/v1/playlists/\" + playlistId + \"/tracks?uris=\" + tracks,\n      type: \"POST\",\n      beforeSend: xhr => {\n        xhr.setRequestHeader(\"Accept\", \"application/json\");\n        xhr.setRequestHeader(\"Content-Type\", \"application/json\");\n        xhr.setRequestHeader(\"Authorization\", \"Bearer \" + this.state.token);\n      },\n      success: data => {\n        if (data != undefined){\n          console.log(data);\n        }\n      }\n    });\n  }\n\n  replacePlaylistSongs(token, playlistId){\n    this.updateQueue(token);\n\n    //create list for adding tracks\n    var tracks = '';\n\n    this.state.queue.map((song) => \n      tracks = tracks + \"spotify%3Atrack%3A\" + song.songId + \",\"\n    )\n\n    $.ajax({\n      url: \"https://api.spotify.com/v1/playlists/\" + playlistId + \"/tracks?uris=\" + tracks,\n      type: \"PUT\",\n      beforeSend: xhr => {\n        xhr.setRequestHeader(\"Accept\", \"application/json\");\n        xhr.setRequestHeader(\"Content-Type\", \"application/json\");\n        xhr.setRequestHeader(\"Authorization\", \"Bearer \" + this.state.token);\n      },\n      success: data => {\n        if (data != undefined){\n          console.log(data);\n        }\n      }\n    });\n  }\n\n  render() {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          {!this.state.token && (\n            <a\n              className=\"btn btn--loginApp-link\"\n              href={`${authEndpoint}?client_id=${clientId}&redirect_uri=${redirectUri}&scope=${scopes.join(\n                \"%20\"\n              )}&response_type=token&show_dialog=true`}\n            >\n              Login to Spotify\n            </a>\n          )}\n          {this.state.token && (\n            <div>\n              <Player\n                item={this.state.item}\n                is_playing={this.state.is_playing}\n                progress_ms={this.progress_ms}\n              />\n              {\"\\n\"}\n              <div className=\"addPlaylist\">\n                <button className=\"btn btn--loginApp-link\" onClick={this.handleCreatePlaylistClick}>\n                  Create Playlist\n                </button>\n              </div>\n              {\"\\n\"}\n              <QueueList />\n              {\"\\n\"}\n              <div className=\"searchsong\">\n                <div className=\"main-wrapper\">\n                  <h1>Add a song:</h1>\n                  {\"\\n\"}\n                  <form className=\"send-song\" onSubmit={this.handleSearchSubmit}>\n                    <input type=\"text\" name=\"songSearchText\" id=\"searchText\" value={this.state.songSearchText} onChange={this.handleSearch} placeholder='Search for a song' />\n                  </form>\n                  {\"\\n\"}\n                  <div className=\"container\">\n                    <ul className='result-list' id='resultsList'>\n                    </ul>\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n        </header>\n      </div>\n    );\n  }\n}\n\nexport default App;"]},"metadata":{},"sourceType":"module"}